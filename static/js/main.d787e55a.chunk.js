(this["webpackJsonpreact-chat"]=this["webpackJsonpreact-chat"]||[]).push([[0],{145:function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),r=n(47),c=n.n(r),i=(n(58),n(30)),l=n.n(i),s=n(48),u=n(13),m=(n(60),n(49)),d=n.n(m),g=n(8),p=n.n(g),f=(n(139),n(143),n(146),n(147),n(50)),v=n(31),h=n(51),b=n.n(h),E=n(52),y=n.n(E);p.a.apps.length?p.a.app():p.a.initializeApp({apiKey:"AIzaSyBpWmtGTqluiA1gC0CEFHrQcZncNRYtjbg",authDomain:"private-school-chat.firebaseapp.com",databaseURL:"https://private-school-chat.firebaseio.com",projectId:"private-school-chat",storageBucket:"private-school-chat.appspot.com",messagingSenderId:"113930891891",appId:"1:113930891891:web:88a3cb1a24e25b06017006"});var w=p.a.auth(),k=p.a.firestore(),N=p.a.messaging(),S=null;Notification.requestPermission().then((function(){console.log("Got permission to recive notifications"),"serviceWorker"in navigator&&navigator.serviceWorker.register("../p-chat/firebase-messaging-sw.js").then((function(e){console.log("Registration successful, scope is:",e.scope),N.getToken({vapidKey:"BJpP6JS8xn9lkBrB0M88LmpChsj46h4YjIoW6rrdgf6rpsl1nWvZ1nBGT7-qyKFmlhdguDvzzcMLXlX4SItN_9k",serviceWorkerRegistration:e}).then((function(e){e?(console.log("current token for client: ",e),S=e,console.log(S),k.collection("msgToken").doc(w.currentUser.uid).set({token:e})):console.log("No registration token available. Request permission to generate one.")})).catch((function(e){console.log("An error occurred while retrieving token. ",e)}))})).catch((function(e){console.log("Service worker registration failed, error:",e)}))})).catch((function(){console.log("Permission denied.")}));var j="_start",I=!0,O=0,x=function(){console.log("Tab is in focus"),I=!0,O=0,document.getElementById("favicon").href="/hbd-games/p-chat/favicon.ico",document.title="Planner"},B=function(){console.log("Tab is blurred"),I=!1},C=function(){return Object(a.useEffect)((function(){return window.addEventListener("focus",x),window.addEventListener("blur",B),x(),function(){window.removeEventListener("focus",x),window.removeEventListener("blur",B)}}),[]),o.a.createElement(o.a.Fragment,null)},L=new b.a(y.a,{volume:1,throttleMs:100});function A(){return o.a.createElement("div",{id:"overlay"},o.a.createElement("div",{id:"overlayText"},o.a.createElement(F,null)))}function F(){var e=k.collection("rooms").orderBy("createdAt"),t=Object(v.a)(e,{idField:"id"}),n=Object(u.a)(t,1)[0];return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"roomList"},o.a.createElement("div",{className:"roomtex"},"Close the room list by hitting the room button to apply changes."),n&&n.map((function(e){return o.a.createElement(P,{key:e.id,message:e})}))))}function P(e){var t=e.message,n=t.roomName,r=t.roomSysName;console.log("message");var c=Object(a.useState)("Not Subbed"),i=Object(u.a)(c,2),l=(i[0],i[1]);return k.collection(r+"-msg").doc(w.currentUser.uid).get().then((function(e){e.exists?l("Subbed"):l("Not Subbed")})),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",null,o.a.createElement("button",{onClick:function(){j=r}},n)))}function R(){return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{className:"sign-in",onClick:function(){var e=new p.a.auth.GoogleAuthProvider;w.signInWithPopup(e)}},"Sign In"),o.a.createElement("div",{className:"opening-text"},"If you cannot see any messages upon logging in, check your internet connection.",o.a.createElement("br",null)," If that does not work, chances are this service has reached it's 'quota' and will no longer function until the next day."))}function U(){return w.currentUser&&o.a.createElement("button",{className:"sign-out",onClick:M},"Sign Out")}function M(){w.signOut()}function T(){var e=Object(a.useRef)(),t=k.collection(j),n=t.orderBy("createdAt").limitToLast(50),r=Object(v.a)(n,{idField:"id"}),c=Object(u.a)(r,1)[0],i=Object(a.useState)(""),m=Object(u.a)(i,2),d=m[0],g=m[1],f=function(){var e=Object(s.a)(l.a.mark((function e(n){var a,o,r,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),a=w.currentUser,o=a.uid,r=a.photoURL,c=w.currentUser.displayName,e.next=5,t.add({text:d,createdAt:p.a.firestore.FieldValue.serverTimestamp(),uid:o,photoURL:r,name:c});case 5:g("");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){(e.current.scrollIntoView({behavior:"smooth"}),L.play(),I)||(O+=1,document.title="("+O+") Planner",document.getElementById("favicon").href="/hbd-games/p-chat/favicon-unread.ico")}),[c]),o.a.createElement(o.a.Fragment,null,o.a.createElement("main",null,o.a.createElement(A,null),c&&c.map((function(e){return o.a.createElement(W,{key:e.id,message:e})}))),o.a.createElement("span",{ref:e}),o.a.createElement("form",{onSubmit:f},o.a.createElement("input",{value:d,onSelect:function(){e.current.scrollIntoView({behavior:"smooth"})},onChange:function(e){return g(e.target.value)},placeholder:"Say something poggers"}),o.a.createElement("button",{type:"submit",disabled:!d},o.a.createElement("span",{role:"img","aria-label":"Send Message"},"\ud83d\udce4"))))}function W(e){var t,n=Object(a.useRef)(),r=e.message,c=r.text,i=r.uid,l=r.photoURL,s=r.createdAt,u=r.name,m=i===w.currentUser.uid?"sent":"received";t=void 0!==u?u!==w.currentUser.displayName?u+" \u2022 ":"You \u2022 ":"Name missing \u2022 ";var g="Sending...",p="";if(null!=s){var f=(g=new Date(s.toDate())).toTimeString().split(":"),v=" ";if(f[0]>=13){var h=parseInt(f[0]);h-=12,f[0]=h.toString(),v="PM"}else v="AM";g="".concat(g.toDateString(),"  ").concat(f[0],":").concat(f[1]," ").concat(v)}return p="sent"===m?"tssent":"tsreceived",o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"message ".concat(m)},o.a.createElement("img",{alt:"Profile",src:l||"https://hideyboi.github.io/hideyboidev/p-chat/missingProfilePicture.png"}),o.a.createElement("div",{className:"MessageContainer"},o.a.createElement(d.a,null,c))),o.a.createElement("div",{className:"timestam ".concat(p),margin:"0px",padding:"0px"},t,g),o.a.createElement("span",{ref:n}))}var D=function(){var e=Object(f.a)(w),t=Object(u.a)(e,1)[0],n=Object(a.useState)(1),r=Object(u.a)(n,2),c=r[0],i=r[1];return o.a.createElement("div",{className:"App"},o.a.createElement("header",null,o.a.createElement("h1",null,"Chat"),o.a.createElement("div",{className:"buttoncontainer"},t?o.a.createElement("button",{onClick:function(){var e=Math.floor(9567444*Math.random())+1;console.log("Current: "+c),i(e),console.log("New: "+c),"flex"!==document.getElementById("overlay").style.display?document.getElementById("overlay").style.display="flex":document.getElementById("overlay").style.display="none"},className:"sign-out"},"Room"):null,o.a.createElement(U,null))),o.a.createElement("section",null,t?o.a.createElement(T,null):o.a.createElement(R,null)),o.a.createElement(C,null))};c.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(D,null)),document.getElementById("root"))},52:function(e,t,n){e.exports=n.p+"static/media/noti.bdc711f4.wav"},53:function(e,t,n){e.exports=n(145)},58:function(e,t,n){},60:function(e,t,n){}},[[53,1,2]]]);
//# sourceMappingURL=main.d787e55a.chunk.js.map