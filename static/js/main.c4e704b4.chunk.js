(this["webpackJsonpreact-chat"]=this["webpackJsonpreact-chat"]||[]).push([[0],{145:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(47),c=n.n(o),i=(n(58),n(30)),l=n.n(i),s=n(48),u=n(13),m=(n(60),n(49)),d=n.n(m),g=n(8),p=n.n(g),f=(n(139),n(143),n(146),n(147),n(50)),v=n(31),h=n(51),b=n.n(h),E=n(52),y=n.n(E);p.a.apps.length?p.a.app():p.a.initializeApp({apiKey:"AIzaSyBpWmtGTqluiA1gC0CEFHrQcZncNRYtjbg",authDomain:"private-school-chat.firebaseapp.com",databaseURL:"https://private-school-chat.firebaseio.com",projectId:"private-school-chat",storageBucket:"private-school-chat.appspot.com",messagingSenderId:"113930891891",appId:"1:113930891891:web:88a3cb1a24e25b06017006"});var k=p.a.auth(),w=p.a.firestore(),N=p.a.messaging(),j=null;Notification.requestPermission().then((function(){console.log("Got permission to recive notifications"),"serviceWorker"in navigator&&navigator.serviceWorker.register("../p-chat/firebase-messaging-sw.js").then((function(e){console.log("Registration successful, scope is:",e.scope),N.getToken({vapidKey:"BJpP6JS8xn9lkBrB0M88LmpChsj46h4YjIoW6rrdgf6rpsl1nWvZ1nBGT7-qyKFmlhdguDvzzcMLXlX4SItN_9k",serviceWorkerRegistration:e}).then((function(e){e?(console.log("current token for client: ",e),j=e,console.log(j),w.collection("msgToken").doc(k.currentUser.uid).set({token:e})):console.log("No registration token available. Request permission to generate one.")})).catch((function(e){console.log("An error occurred while retrieving token. ",e)}))})).catch((function(e){console.log("Service worker registration failed, error:",e)}))})).catch((function(){console.log("Permission denied.")}));var S="_start",O=!0,I=0,x=function(){console.log("Tab is in focus"),O=!0,I=0,document.getElementById("favicon").href="/hbd-games/p-chat/favicon.ico",document.title="Planner"},B=function(){console.log("Tab is blurred"),O=!1},C=function(){return Object(a.useEffect)((function(){return window.addEventListener("focus",x),window.addEventListener("blur",B),x(),function(){window.removeEventListener("focus",x),window.removeEventListener("blur",B)}}),[]),r.a.createElement(r.a.Fragment,null)},L=new b.a(y.a,{volume:1,throttleMs:100});function A(){return r.a.createElement("div",{id:"overlay"},r.a.createElement("div",{id:"overlayText"},r.a.createElement(F,null)))}function F(){var e=w.collection("rooms").orderBy("createdAt"),t=Object(v.a)(e,{idField:"id"}),n=Object(u.a)(t,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"roomList"},r.a.createElement("div",{className:"roomtex"},"Close the room list by hitting the room button to apply changes."),n&&n.map((function(e){return r.a.createElement(P,{key:e.id,message:e})}))))}function P(e){var t=e.message,n=t.roomName,o=t.roomSysName;console.log("message");var c=Object(a.useState)("Not Subbed"),i=Object(u.a)(c,2),l=(i[0],i[1]);return w.collection(o+"-msg").doc(k.currentUser.uid).get().then((function(e){e.exists?l("Subbed"):l("Not Subbed")})),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("button",{onClick:function(){S=o}},n)))}function R(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"sign-in",onClick:function(){var e=new p.a.auth.GoogleAuthProvider;k.signInWithPopup(e)}},"Sign In"),r.a.createElement("div",{className:"opening-text"},"If you cannot see any messages upon logging in, check your internet connection.",r.a.createElement("br",null)," If that does not work, chances are this service has reached it's 'quota' and will no longer function until the next day."))}function U(){return k.currentUser&&r.a.createElement("button",{className:"sign-out",onClick:M},"Sign Out")}function M(){k.signOut()}function T(){var e=Object(a.useRef)(),t=w.collection(S),n=t.orderBy("createdAt").limitToLast(50),o=Object(v.a)(n,{idField:"id"}),c=Object(u.a)(o,1)[0],i=Object(a.useState)(""),m=Object(u.a)(i,2),d=m[0],g=m[1],f=function(){var e=Object(s.a)(l.a.mark((function e(n){var a,r,o,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),a=k.currentUser,r=a.uid,o=a.photoURL,c=k.currentUser.displayName,e.next=5,t.add({text:d,createdAt:p.a.firestore.FieldValue.serverTimestamp(),uid:r,photoURL:o,name:c});case 5:g("");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){(e.current.scrollIntoView({behavior:"smooth"}),L.play(),O)||(I+=1,document.title="("+I+") Planner",document.getElementById("favicon").href="/hbd-games/p-chat/favicon-unread.ico")}),[c]),r.a.createElement(r.a.Fragment,null,r.a.createElement("main",null,r.a.createElement(A,null),c&&c.map((function(e){return r.a.createElement(W,{key:e.id,message:e})}))),r.a.createElement("span",{ref:e}),r.a.createElement("form",{onSubmit:f},r.a.createElement("input",{value:d,onChange:function(e){return g(e.target.value)},placeholder:"Say something poggers"}),r.a.createElement("button",{type:"submit",disabled:!d},r.a.createElement("span",{role:"img","aria-label":"Send Message"},"\ud83d\udce4"))))}function W(e){var t,n=Object(a.useRef)(),o=e.message,c=o.text,i=o.uid,l=o.photoURL,s=o.createdAt,u=o.name,m=i===k.currentUser.uid?"sent":"received";t=void 0!==u?u!==k.currentUser.displayName?u+" \u2022 ":"You \u2022 ":"Name missing \u2022 ";var g="Sending...",p="";if(null!=s){var f=(g=new Date(s.toDate())).toTimeString().split(":"),v=" ";if(f[0]>=13){var h=parseInt(f[0]);h-=12,f[0]=h.toString(),v="PM"}else v="AM";g="".concat(g.toDateString(),"  ").concat(f[0],":").concat(f[1]," ").concat(v)}return p="sent"===m?"tssent":"tsreceived",r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"message ".concat(m)},r.a.createElement("img",{alt:"Profile",src:l||"https://hideyboi.github.io/hideyboidev/p-chat/missingProfilePicture.png"}),r.a.createElement("div",{className:"MessageContainer"},r.a.createElement(d.a,null,c))),r.a.createElement("div",{className:"timestam ".concat(p),margin:"0px",padding:"0px"},t,g),r.a.createElement("span",{ref:n}))}var D=function(){var e=Object(f.a)(k),t=Object(u.a)(e,1)[0],n=Object(a.useState)(1),o=Object(u.a)(n,2),c=o[0],i=o[1];return r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement("h1",null,"Chat"),r.a.createElement("div",{className:"buttoncontainer"},t?r.a.createElement("button",{onClick:function(){var e=Math.floor(9567444*Math.random())+1;console.log("Current: "+c),i(e),console.log("New: "+c),"flex"!==document.getElementById("overlay").style.display?document.getElementById("overlay").style.display="flex":document.getElementById("overlay").style.display="none"},className:"sign-out"},"Room"):null,r.a.createElement(U,null))),r.a.createElement("section",null,t?r.a.createElement(T,null):r.a.createElement(R,null)),r.a.createElement(C,null))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(D,null)),document.getElementById("root"))},52:function(e,t,n){e.exports=n.p+"static/media/noti.bdc711f4.wav"},53:function(e,t,n){e.exports=n(145)},58:function(e,t,n){},60:function(e,t,n){}},[[53,1,2]]]);
//# sourceMappingURL=main.c4e704b4.chunk.js.map