{"version":3,"sources":["Start.js","App.js","index.js","noti.wav"],"names":["StartScreen","props","currentName","userName","id","firebase","apps","length","app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","auth","firestore","room","roomDisplayName","focused","messagesSinceLastOpen","imageToAttach","onFocus","console","log","document","getElementById","href","title","onBlur","WindowFocusHandler","useEffect","window","addEventListener","removeEventListener","noti","UIfx","sound","volume","throttleMs","Start","currentUser","displayName","ChatRoom","RoomSelect","RoomList","query","collection","orderBy","useCollectionData","idField","messages","className","map","msg","RoomButton","key","message","roomName","roomSysName","onClick","SignIn","provider","GoogleAuthProvider","signInWithPopup","SignOut","RemoveAuth","signOut","dummy","useRef","messagesRef","limitToLast","prevMsgTime","prevMsgType","prevMsgUUID","messageCount","sendMessage","e","a","preventDefault","uid","photoURL","username","imgurl","tex","value","add","text","createdAt","FieldValue","serverTimestamp","name","attatchment","current","scrollIntoView","ChatMessage","onInputCapture","onSubmit","placeholder","autoComplete","type","role","aria-label","ImgurUploadButton","ref","useState","uploadStatus","setUploadStatus","onChange","getElementsByClassName","files","storageRef","storage","rng","Math","floor","random","child","put","then","snapshot","getDownloadURL","url","style","display","messageClass","alreadyPlayed","setPlayed","currentMsgPos","push","play","timestamp","undefined","minDiff","toDate","error","timestampClass","tsTimeSplit","Date","toTimeString","split","pmAm","tsInt","parseInt","toString","toDateString","alt","src","target","App","useAuthState","user","stateRoom","setRoom","roomButtonName","setButtonName","ReactDOM","render","StrictMode","module","exports"],"mappings":"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","file":"static/js/main.af36ce37.chunk.js","sourcesContent":["import React from \"react\";\r\nimport './Start.css';\r\n\r\nfunction StartScreen (props) {\r\n    var currentName = props.userName;\r\n\r\n    if (currentName === \"Ciara Lee\") {\r\n        currentName = \"Ciara Lee, the cutest person in the whole world!\"\r\n    }\r\n\r\n    return(<div id=\"startRoom\">\r\n        <h1>Welcome!</h1>\r\n        <p>Signed in as {currentName}</p>\r\n        <h2>Notice</h2>\r\n        <p>\r\n            By using this application, you grant it permission to use cookies.<br/>\r\n            You can be banned from this application for any reason and might not be given and explaination.\r\n        </p>\r\n    </div>)\r\n}\r\n\r\nexport default StartScreen;","import React, { useEffect, useRef, useState } from 'react';\r\nimport './App.css';\r\n\r\nimport ReactMarkdown from 'react-markdown';\r\n\r\nimport firebase from 'firebase/app';\r\nimport 'firebase/firestore';\r\nimport 'firebase/auth';\r\nimport 'firebase/analytics';\r\nimport 'firebase/messaging';\r\nimport 'firebase/storage'\r\n\r\nimport { useAuthState } from 'react-firebase-hooks/auth';\r\nimport { useCollectionData } from 'react-firebase-hooks/firestore';\r\n\r\n\r\nimport UIfx from 'uifx';\r\nimport sound from './noti.wav';\r\nimport StartScreen from './Start'\r\n\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp({\r\n      apiKey: \"AIzaSyBpWmtGTqluiA1gC0CEFHrQcZncNRYtjbg\",\r\n      authDomain: \"private-school-chat.firebaseapp.com\",\r\n      databaseURL: \"https://private-school-chat.firebaseio.com\",\r\n      projectId: \"private-school-chat\",\r\n      storageBucket: \"private-school-chat.appspot.com\",\r\n      messagingSenderId: \"113930891891\",\r\n      appId: \"1:113930891891:web:88a3cb1a24e25b06017006\"\r\n  })\r\n}else {\r\n  firebase.app(); // if already initialized, use that one\r\n}\r\n\r\nconst auth = firebase.auth();\r\nconst firestore = firebase.firestore();\r\n\r\n\r\n\r\n/*\r\nconst messaging = firebase.messaging();\r\n\r\nvar msgToken = null;\r\n\r\n\r\nNotification.requestPermission()\r\n.then(function() {\r\n  console.log(\"Got permission to recive notifications\")\r\n  \r\n  if (\"serviceWorker\" in navigator) {\r\n    navigator.serviceWorker\r\n      .register('../p-chat/firebase-messaging-sw.js')\r\n      .then(function(registration) {\r\n        console.log(\"Registration successful, scope is:\", registration.scope);\r\n        messaging.getToken({vapidKey: 'BJpP6JS8xn9lkBrB0M88LmpChsj46h4YjIoW6rrdgf6rpsl1nWvZ1nBGT7-qyKFmlhdguDvzzcMLXlX4SItN_9k', serviceWorkerRegistration : registration })\r\n          .then((currentToken) => {\r\n            if (currentToken) {\r\n              console.log('current token for client: ', currentToken);\r\n    \r\n              msgToken = currentToken;\r\n              console.log(msgToken);\r\n\r\n              firestore.collection(\"msgToken\").doc(auth.currentUser.uid).set({\r\n                token: currentToken\r\n              });\r\n            } else {\r\n              console.log('No registration token available. Request permission to generate one.');\r\n    \r\n              // shows on the UI that permission is required \r\n            }\r\n          }).catch((err) => {\r\n            console.log('An error occurred while retrieving token. ', err);\r\n            // catch error while creating client token\r\n          });  \r\n        })\r\n        .catch(function(err) {\r\n          console.log(\"Service worker registration failed, error:\"  , err );\r\n      }); \r\n    }\r\n})\r\n.catch(function() {\r\n  console.log(\"Permission denied.\")\r\n});\r\n*/\r\n\r\n\r\nvar room = \"_start\";\r\nvar roomDisplayName = \"START\";\r\n\r\nvar focused = true;\r\nvar messagesSinceLastOpen = 0;\r\n\r\nvar imageToAttach = \"\";\r\n\r\nconst onFocus = () => {\r\n  console.log(\"Tab is in focus\");\r\n  focused = true;\r\n  messagesSinceLastOpen = 0;\r\n  const favicon = document.getElementById(\"favicon\")\r\n  favicon.href = \"/p-chat/favicon.ico\";\r\n  document.title = \"Planner\"\r\n};\r\nconst onBlur = () => {\r\n  console.log(\"Tab is blurred\");\r\n  focused = false;\r\n};\r\nconst WindowFocusHandler = () => {\r\n  useEffect(() => {\r\n      window.addEventListener(\"focus\", onFocus);\r\n      window.addEventListener(\"blur\", onBlur);\r\n      // Calls onFocus when the window first loads\r\n      onFocus();\r\n      // Specify how to clean up after this effect:\r\n      return () => {\r\n          window.removeEventListener(\"focus\", onFocus);\r\n          window.removeEventListener(\"blur\", onBlur);\r\n      };\r\n}, []);\r\n\r\n  return <></>;\r\n};\r\nconst noti = new UIfx(\r\n  sound,\r\n  {\r\n    volume: 1, // number between 0.0 ~ 1.0\r\n    throttleMs: 100\r\n  }\r\n)\r\n\r\nfunction App() {\r\n\r\n  const [user] = useAuthState(auth);\r\n\r\n  const [stateRoom, setRoom] = useState(1);\r\n\r\n  const [roomButtonName, setButtonName] = useState(\"Rooms\")\r\n\r\n\r\n  function RoomSwitch() { \r\n    var rng = Math.floor(Math.random() * 9567444) + 1; \r\n\r\n    if (roomButtonName === \"Rooms\") {\r\n      setButtonName(\"Close Menu\");\r\n    } else {\r\n      setButtonName(\"Rooms\");\r\n    }\r\n\r\n    console.log('Current: ' + stateRoom);\r\n    setRoom(rng);\r\n    console.log('New: ' + stateRoom);\r\n    switchRoom();\r\n  }\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <header>\r\n        <h1>Chat</h1>\r\n        <div className='buttoncontainer'>\r\n          {user ? <button onClick={RoomSwitch} className=\"sign-out\">{roomButtonName}</button> : null}\r\n          <SignOut />\r\n        </div>\r\n      </header>\r\n\r\n      <section>\r\n        {user ? <>{room === \"_start\" ? <Start /> : <ChatRoom />}</> : <SignIn />}\r\n      </section>\r\n      <WindowFocusHandler></WindowFocusHandler>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction Start() {\r\n  return(<>\r\n    <StartScreen userName={auth.currentUser.displayName} />\r\n    <ChatRoom />\r\n  </>)\r\n}\r\n\r\nfunction RoomSelect() {\r\n  return (\r\n    <div id=\"overlay\">\r\n      <div id=\"overlayText\"><RoomList /></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction RoomList() {\r\n  const messagesRef = firestore.collection(\"rooms\");\r\n  const query = messagesRef.orderBy('createdAt');\r\n\r\n  const [messages] = useCollectionData(query, { idField: 'id' });\r\n\r\n  return (<>\r\n    <div className=\"roomList\">\r\n\r\n      <div className='roomtex'>Close the room list by hitting the room button to apply changes.</div>\r\n\r\n      {messages && messages.map(msg => <RoomButton key={msg.id} message={msg} />)}\r\n\r\n    </div>\r\n  </>)\r\n}\r\n\r\nfunction RoomButton(props) {\r\n  const { roomName, roomSysName } = props.message;\r\n\r\n  function SetRoom() {\r\n    room = roomSysName;\r\n    roomDisplayName = roomName;\r\n  }\r\n\r\n  /*\r\n  firestore.collection(roomSysName + \"-msg\").doc(auth.currentUser.uid).get().then((doc) => {\r\n    if (doc.exists){\r\n      setNotiButton(\"Subbed\");\r\n    } else {\r\n      setNotiButton(\"Not Subbed\");\r\n    }\r\n  })\r\n\r\n  const [notiButton, setNotiButton] = useState(\"Not Subbed\");\r\n  function clickedNotiButton() {\r\n    if (notiButton === \"Not Subbed\") {\r\n      var uid = auth.currentUser.uid;\r\n      firestore.collection(roomSysName + \"-msg\").doc(auth.currentUser.uid).set({\r\n        name: uid\r\n      });\r\n      setNotiButton('Subbed');\r\n    } else {\r\n      firestore.collection(roomSysName + \"-msg\").doc(auth.currentUser.uid).delete();\r\n      setNotiButton('Not Subbed');\r\n    }\r\n  }\r\n  */\r\n\r\n  //<button onClick={clickedNotiButton}>{notiButton}</button>\r\n\r\n  return (<>\r\n    <div>\r\n      <button onClick={SetRoom}>{roomName}</button>\r\n    </div>\r\n  </>)\r\n}\r\n\r\nfunction switchRoom() {\r\n  \r\n  if (document.getElementById(\"overlay\").style.display !== \"flex\") {\r\n    document.getElementById(\"overlay\").style.display = \"flex\";\r\n  } else {\r\n    document.getElementById(\"overlay\").style.display = \"none\";\r\n  } \r\n}\r\n\r\nfunction SignIn() {\r\n\r\n  const signInWithGoogle = () => {\r\n    const provider = new firebase.auth.GoogleAuthProvider();\r\n    auth.signInWithPopup(provider);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <button className=\"sign-in\" onClick={signInWithGoogle}>Sign In</button>\r\n      <div className=\"opening-text\">If you cannot sign in, please check your pop-up blocker and internet connection.</div>\r\n    </>\r\n  )\r\n\r\n}\r\n\r\nfunction SignOut() {\r\n  \r\n  return auth.currentUser && (\r\n    <button className=\"sign-out\" onClick={RemoveAuth}>Sign Out</button>\r\n  )\r\n}\r\n\r\nfunction RemoveAuth() {\r\n  auth.signOut();\r\n}\r\n\r\n\r\nfunction ChatRoom() {\r\n  const dummy = useRef();\r\n  const messagesRef = firestore.collection(room);\r\n  const query = messagesRef.orderBy('createdAt').limitToLast(50);\r\n\r\n  const [messages] = useCollectionData(query, { idField: 'id' });\r\n\r\n  prevMsgTime = [];\r\n  prevMsgType = [];\r\n  prevMsgUUID = [];\r\n  messageCount = 0;\r\n\r\n  const sendMessage = async (e) => {\r\n    e.preventDefault();\r\n\r\n    const { uid, photoURL } = auth.currentUser;\r\n    var username = auth.currentUser.displayName;\r\n    var imgurl = imageToAttach;\r\n    \r\n    var tex = document.getElementById(\"MSGINPUT\").value;\r\n    document.getElementById(\"MSGINPUT\").value = \"\";\r\n\r\n    if (tex === \"\") {\r\n      return;\r\n    }\r\n\r\n    prevMsgTime = [];\r\n    prevMsgType = [];\r\n    prevMsgUUID = [];\r\n    messageCount = 0;\r\n\r\n    imageToAttach = \"\"\r\n\r\n    await messagesRef.add({\r\n      text: tex,\r\n      createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n      uid,\r\n      photoURL,\r\n      name: username,\r\n      attatchment: imgurl\r\n    })\r\n  }\r\n\r\n  useEffect(() => {\r\n    dummy.current.scrollIntoView();\r\n    if (!focused) {\r\n      messagesSinceLastOpen += 1;\r\n      document.title = \"(\" + messagesSinceLastOpen + \") Planner\";\r\n      const icon = document.getElementById(\"favicon\")\r\n      icon.href = \"/p-chat/favicon-unread.ico\";\r\n    }\r\n  }, [messages])\r\n\r\n  function inputInteracted () {\r\n    dummy.current.scrollIntoView();\r\n  }\r\n\r\n  return (<>\r\n    <main>\r\n        <RoomSelect/>\r\n        {messages && messages.map(msg => <ChatMessage key={msg.id} message={msg} />)}\r\n        <div className='messageBar'>\r\n          <form onInputCapture={inputInteracted}>\r\n            <input id=\"MSGINPUT\" onSubmit={sendMessage} placeholder={\"Message \" + roomDisplayName} autoComplete=\"none\" />\r\n            <button onClick={sendMessage} type=\"submit\"><span role=\"img\" aria-label='Send Message'>📤</span></button>\r\n          </form>\r\n          <ImgurUploadButton />\r\n        </div>\r\n    </main>\r\n    <span ref={dummy}></span>\r\n  </>)\r\n}\r\n\r\nfunction ImgurUploadButton () {\r\n  const [uploadStatus, setUploadStatus] = useState(\"\");\r\n\r\n  function showUpload() {\r\n    document.getElementById(\"imgurUpload\").style.display = \"block\"\r\n  }\r\n\r\n  function closeUpload() {\r\n    document.getElementById(\"imgurUpload\").style.display = \"none\"\r\n  }\r\n\r\n  function upload() {\r\n    const e = document.getElementsByClassName('input-image')[0].files[0]\r\n\r\n    var storageRef = firebase.storage().ref();\r\n\r\n    console.log(e.type);\r\n\r\n    var rng = Math.floor(Math.random() * 69696969 + 1);\r\n\r\n    setUploadStatus(\"Uploading!\")\r\n\r\n    storageRef.child(\"images/\" + rng).put(e).then(function(snapshot) {\r\n      snapshot.ref.getDownloadURL().then(function(url) {\r\n        imageToAttach = url;\r\n        setUploadStatus(\"File uploaded! The next message you send will have this attachment, refresh now to cancel!\");\r\n      })\r\n    });\r\n  }\r\n/*\r\n    setUploadStatus(\"Uploading image...\");\r\n\r\n    d.append('image', e)\r\n  \r\n    r.open('POST', 'https://api.imgur.com/3/image')\r\n    r.setRequestHeader('Authorization', `Client-ID cb4d8f29a6eaf8c`)\r\n    r.onreadystatechange = function () {\r\n      if(r.status === 200 && r.readyState === 4) {\r\n        let res = JSON.parse(r.responseText)\r\n        u = `https://i.imgur.com/${res.data.id}.png`\r\n        imageToAttach = u\r\n        console.log(\"Uploaded to \" + u);\r\n        setUploadStatus(\"Uploaded! This image will be attatched to the next message you send, refresh the page now to cancel.\")\r\n      }\r\n    }\r\n    r.onerror = function () {\r\n      setUploadStatus(\"An error has occured, check that the desired file is something that can be uploaded to imgur and is also not too large!\")\r\n    }\r\n    r.send(d)\r\n*/\r\n\r\n  return(<>\r\n    <div id='imgurUpload'>\r\n      <div id='imgurUploadInner'>\r\n        <h2>Upload image</h2>\r\n        <form>\r\n          <input type=\"file\" className='input-image' onChange={upload}/>\r\n        </form>\r\n        <p>{uploadStatus}</p>\r\n        <button onClick={closeUpload}>Close</button>\r\n      </div>\r\n    </div>\r\n    <button onClick={showUpload}><span role=\"img\" aria-label='Attatch file'>⬆</span></button>\r\n  </>)\r\n}\r\n\r\nvar prevMsgType = [];\r\nvar prevMsgTime = [];\r\nvar messageCount = 0;\r\nvar prevMsgUUID = [];\r\n\r\nfunction ChatMessage(props) {\r\n  const dummy = useRef();\r\n  const { text, uid, photoURL, createdAt, name, attatchment } = props.message;\r\n\r\n  const messageClass = uid === auth.currentUser.uid ? 'sent' : 'received';\r\n  const [alreadyPlayed, setPlayed] = useState(false);\r\n\r\n  var username;\r\n\r\n  var currentMsgPos = messageCount;\r\n\r\n  prevMsgType.push(messageClass);\r\n  prevMsgTime.push(createdAt);\r\n  prevMsgUUID.push(uid);\r\n  messageCount = messageCount + 1;\r\n\r\n  console.log(prevMsgType);\r\n  console.log(prevMsgTime);\r\n  console.log(prevMsgUUID);\r\n  console.log(currentMsgPos);\r\n\r\n  //eslint-disable-next-line\r\n  useEffect(function() {\r\n    if (messageClass === \"received\") {\r\n      if (!alreadyPlayed) {\r\n        noti.play();\r\n        setPlayed(true);\r\n      }\r\n    }\r\n\r\n    if (currentMsgPos < 1 || timestamp === \"Sending...\") {\r\n      return;\r\n    }\r\n    if (createdAt !== undefined && prevMsgTime[currentMsgPos - 1] !== null && prevMsgTime[currentMsgPos - 1] !== undefined){\r\n      var minDiff = Math.floor((createdAt.toDate() - prevMsgTime[currentMsgPos - 1].toDate())/1000/60)\r\n    }\r\n\r\n    if (messageClass === prevMsgType[currentMsgPos - 1] && prevMsgUUID[currentMsgPos - 1] === uid && minDiff < 1) {\r\n      var e = document.getElementById(\"timestamp\" + (currentMsgPos - 1));\r\n      try {\r\n        e.style.display = \"none\";\r\n        console.log(\"Changed\");\r\n      } catch (error) {\r\n      }\r\n    }\r\n  });\r\n\r\n  if (name !== undefined){\r\n    if (name !== auth.currentUser.displayName)\r\n    {\r\n      username = name + \" • \";\r\n    } else {\r\n      username = \"You • \"\r\n      if (name === \"Ciara Lee\") {\r\n        username = \"You, aka the cutest person ever • \"\r\n      }\r\n    }\r\n  } else {\r\n    username = \"Name missing • \";\r\n  }\r\n\r\n  var timestamp = 'Sending...';\r\n  var timestampClass = '';\r\n\r\n  if (createdAt != null) {\r\n    timestamp = new Date(createdAt.toDate());\r\n    var tsTime = timestamp.toTimeString();\r\n\r\n    var tsTimeSplit = tsTime.split(':');\r\n\r\n    var pmAm = ' ';\r\n\r\n    if (tsTimeSplit[0] >= 13) {\r\n      var tsInt = parseInt(tsTimeSplit[0]);\r\n      tsInt = tsInt - 12;\r\n      tsTimeSplit[0] = tsInt.toString();\r\n      pmAm = 'PM';\r\n    } else {\r\n      pmAm = 'AM';\r\n    }\r\n\r\n    timestamp = `${timestamp.toDateString()}  ${tsTimeSplit[0]}:${tsTimeSplit[1]} ${pmAm}`\r\n  }\r\n\r\n  if (messageClass === 'sent'){\r\n    timestampClass = 'tssent';\r\n  } else {\r\n    timestampClass = 'tsreceived';\r\n  }\r\n\r\n  return (<>\r\n    <div className={`message ${messageClass}`}>\r\n      <img alt=\"Profile\" src={photoURL || 'https://hideyboi.github.io/p-chat/missingProfilePicture.png'} />\r\n        {timestamp === \"Sending...\" ? <img alt=\"sending\" src='/p-chat/loading.gif'></img>\r\n        :\r\n        <>{text ? <div className='MessageContainer'>\r\n        <div className=\"messageText\"><ReactMarkdown>{text}</ReactMarkdown></div>\r\n      </div>\r\n      : <span></span>}\r\n       </>}\r\n\r\n    </div>\r\n    {attatchment ? \r\n      <div className={\"attatchmentContainer \" + messageClass}>\r\n        <a className=\"attatchment\" href={attatchment} target=\"_empty\" alt=\"Open Attatchment in new tab\">\r\n          <img alt='attatchment' src={attatchment} />\r\n        </a> \r\n      </div>\r\n    : \r\n      <span></span>\r\n    }\r\n\r\n    <div id={\"timestamp\" + currentMsgPos} className={`timestamp ${timestampClass}`}>{username}{timestamp}</div>\r\n    <span ref={dummy}></span>\r\n  </>)\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n","module.exports = __webpack_public_path__ + \"static/media/noti.bdc711f4.wav\";"],"sourceRoot":""}