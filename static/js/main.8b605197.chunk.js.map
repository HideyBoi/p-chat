{"version":3,"sources":["App.js","index.js","noti.wav"],"names":["firebase","apps","length","app","initializeApp","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","auth","firestore","messaging","Notification","requestPermission","then","console","log","navigator","serviceWorker","register","registration","scope","getToken","vapidKey","serviceWorkerRegistration","currentToken","catch","err","room","focused","messagesSinceLastOpen","onFocus","document","getElementById","href","title","onBlur","WindowFocusHandler","useEffect","window","addEventListener","removeEventListener","noti","UIfx","sound","volume","throttleMs","RoomSelect","id","RoomList","query","collection","orderBy","useCollectionData","idField","messages","className","map","msg","RoomButton","key","message","props","roomName","roomSysName","onClick","SignIn","provider","GoogleAuthProvider","signInWithPopup","SignOut","currentUser","RemoveAuth","signOut","ChatRoom","dummy","useRef","messagesRef","limitToLast","useState","formValue","setFormValue","sendMessage","e","a","preventDefault","uid","photoURL","username","displayName","add","text","createdAt","FieldValue","serverTimestamp","name","current","scrollIntoView","behavior","play","ChatMessage","ref","onSubmit","value","onChange","target","placeholder","type","disabled","messageClass","undefined","timestamp","timestampClass","Date","toDate","toDateString","tsTimeSplit","toTimeString","split","pmAm","tsInt","parseInt","toString","alt","src","margin","padding","App","useAuthState","user","stateRoom","setRoom","rng","Math","floor","random","style","display","ReactDOM","render","StrictMode","module","exports"],"mappings":"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","file":"static/js/main.8b605197.chunk.js","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport './App.css';\r\n\r\nimport ReactMarkdown from 'react-markdown';\r\n\r\nimport firebase from 'firebase/app';\r\nimport 'firebase/firestore';\r\nimport 'firebase/auth';\r\nimport 'firebase/analytics';\r\nimport 'firebase/messaging';\r\n\r\n\r\nimport { useAuthState } from 'react-firebase-hooks/auth';\r\nimport { useCollectionData } from 'react-firebase-hooks/firestore';\r\n\r\n\r\nimport UIfx from 'uifx';\r\nimport sound from './noti.wav';\r\n\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp({\r\n      apiKey: \"AIzaSyBpWmtGTqluiA1gC0CEFHrQcZncNRYtjbg\",\r\n      authDomain: \"private-school-chat.firebaseapp.com\",\r\n      databaseURL: \"https://private-school-chat.firebaseio.com\",\r\n      projectId: \"private-school-chat\",\r\n      storageBucket: \"private-school-chat.appspot.com\",\r\n      messagingSenderId: \"113930891891\",\r\n      appId: \"1:113930891891:web:88a3cb1a24e25b06017006\"\r\n  })\r\n}else {\r\n  firebase.app(); // if already initialized, use that one\r\n}\r\n\r\nconst auth = firebase.auth();\r\nconst firestore = firebase.firestore();\r\n\r\nconst messaging = firebase.messaging();\r\n\r\nvar msgToken = null;\r\n\r\nNotification.requestPermission()\r\n.then(function() {\r\n  console.log(\"Got permission to recive notifications\")\r\n  \r\n  if (\"serviceWorker\" in navigator) {\r\n    navigator.serviceWorker\r\n      .register('../p-chat/firebase-messaging-sw.js')\r\n      .then(function(registration) {\r\n        console.log(\"Registration successful, scope is:\", registration.scope);\r\n        messaging.getToken({vapidKey: 'BJpP6JS8xn9lkBrB0M88LmpChsj46h4YjIoW6rrdgf6rpsl1nWvZ1nBGT7-qyKFmlhdguDvzzcMLXlX4SItN_9k', serviceWorkerRegistration : registration })\r\n          .then((currentToken) => {\r\n            if (currentToken) {\r\n              console.log('current token for client: ', currentToken);\r\n    \r\n              msgToken = currentToken\r\n            } else {\r\n              console.log('No registration token available. Request permission to generate one.');\r\n    \r\n              // shows on the UI that permission is required \r\n            }\r\n          }).catch((err) => {\r\n            console.log('An error occurred while retrieving token. ', err);\r\n            // catch error while creating client token\r\n          });  \r\n        })\r\n        .catch(function(err) {\r\n          console.log(\"Service worker registration failed, error:\"  , err );\r\n      }); \r\n    }\r\n})\r\n.catch(function() {\r\n  console.log(\"Permission denied.\")\r\n});\r\n\r\n\r\nvar room = \"_start\";\r\n\r\nvar focused = true;\r\nvar messagesSinceLastOpen = 0;\r\n\r\nconst onFocus = () => {\r\n  console.log(\"Tab is in focus\");\r\n  focused = true;\r\n  messagesSinceLastOpen = 0;\r\n  const favicon = document.getElementById(\"favicon\")\r\n  favicon.href = \"/hbd-games/p-chat/favicon.ico\";\r\n  document.title = \"Planner\"\r\n};\r\n\r\n// User has switched away from the tab (AKA tab is hidden)\r\nconst onBlur = () => {\r\n  console.log(\"Tab is blurred\");\r\n  focused = false;\r\n};\r\n\r\nconst WindowFocusHandler = () => {\r\n  useEffect(() => {\r\n      window.addEventListener(\"focus\", onFocus);\r\n      window.addEventListener(\"blur\", onBlur);\r\n      // Calls onFocus when the window first loads\r\n      onFocus();\r\n      // Specify how to clean up after this effect:\r\n      return () => {\r\n          window.removeEventListener(\"focus\", onFocus);\r\n          window.removeEventListener(\"blur\", onBlur);\r\n      };\r\n}, []);\r\n\r\n  return <></>;\r\n};\r\n\r\nconst noti = new UIfx(\r\n  sound,\r\n  {\r\n    volume: 1, // number between 0.0 ~ 1.0\r\n    throttleMs: 100\r\n  }\r\n)\r\n\r\nfunction App() {\r\n\r\n  const [user] = useAuthState(auth);\r\n\r\n  const [stateRoom, setRoom] = useState(1);\r\n\r\n\r\n  function RoomSwitch() { \r\n    var rng = Math.floor(Math.random() * 9567444) + 1; \r\n\r\n    console.log('Current: ' + stateRoom);\r\n    setRoom(rng);\r\n    console.log('New: ' + stateRoom);\r\n    switchRoom();\r\n  }\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <header>\r\n        <h1>Chat</h1>\r\n        <div className='buttoncontainer'>\r\n          {user ? <button onClick={RoomSwitch} className=\"sign-out\">Room</button> : null}\r\n          <SignOut />\r\n        </div>\r\n      </header>\r\n\r\n      <section>\r\n        {user ? <ChatRoom /> : <SignIn />}\r\n      </section>\r\n      <WindowFocusHandler></WindowFocusHandler>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction RoomSelect() {\r\n  return (\r\n    <div id=\"overlay\">\r\n      <div id=\"overlayText\"><RoomList /></div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction RoomList() {\r\n  const messagesRef = firestore.collection(\"rooms\");\r\n  const query = messagesRef.orderBy('createdAt');\r\n\r\n  const [messages] = useCollectionData(query, { idField: 'id' });\r\n\r\n  return (<>\r\n    <div className=\"roomList\">\r\n\r\n      <div className='roomtex'>Close the room list by hitting the room button to apply changes.</div>\r\n\r\n      {messages && messages.map(msg => <RoomButton key={msg.id} message={msg} />)}\r\n\r\n    </div>\r\n  </>)\r\n}\r\n\r\nfunction RoomButton(props) {\r\n  const { roomName, roomSysName } = props.message;\r\n  console.log(\"message\");\r\n\r\n  function SetRoom() {\r\n    room = roomSysName;\r\n  }\r\n\r\n  return (<>\r\n    <div>\r\n      <button onClick={SetRoom}>{roomName}</button>\r\n    </div>\r\n  </>)\r\n}\r\n\r\nfunction switchRoom() {\r\n  \r\n  if (document.getElementById(\"overlay\").style.display !== \"flex\") {\r\n    document.getElementById(\"overlay\").style.display = \"flex\";\r\n  } else {\r\n    document.getElementById(\"overlay\").style.display = \"none\";\r\n  } \r\n}\r\n\r\nfunction SignIn() {\r\n\r\n  const signInWithGoogle = () => {\r\n    const provider = new firebase.auth.GoogleAuthProvider();\r\n    auth.signInWithPopup(provider);\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <button className=\"sign-in\" onClick={signInWithGoogle}>Sign In</button>\r\n      <div className=\"opening-text\">If you cannot see any messages upon logging in, check your internet connection.<br/> If that does not work, chances are this service has reached it's 'quota' and will no longer function until the next day.</div>\r\n    </>\r\n  )\r\n\r\n}\r\n\r\nfunction SignOut() {\r\n  \r\n  return auth.currentUser && (\r\n    <button className=\"sign-out\" onClick={RemoveAuth}>Sign Out</button>\r\n  )\r\n}\r\n\r\nfunction RemoveAuth() {\r\n  auth.signOut();\r\n}\r\n\r\n\r\nfunction ChatRoom() {\r\n  const dummy = useRef();\r\n  const messagesRef = firestore.collection(room);\r\n  const query = messagesRef.orderBy('createdAt').limitToLast(50);\r\n\r\n  const [messages] = useCollectionData(query, { idField: 'id' });\r\n\r\n  const [formValue, setFormValue] = useState('');\r\n\r\n  const sendMessage = async (e) => {\r\n    e.preventDefault();\r\n\r\n    const { uid, photoURL } = auth.currentUser;\r\n    var username = auth.currentUser.displayName;\r\n\r\n    await messagesRef.add({\r\n      text: formValue,\r\n      createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n      uid,\r\n      photoURL,\r\n      name: username\r\n    })\r\n\r\n    setFormValue('');\r\n  }\r\n\r\n  useEffect(() => {\r\n    dummy.current.scrollIntoView({ behavior: 'smooth' });\r\n    noti.play();\r\n    if (!focused) {\r\n      messagesSinceLastOpen += 1;\r\n      document.title = \"(\" + messagesSinceLastOpen + \") Planner\";\r\n      const icon = document.getElementById(\"favicon\")\r\n      icon.href = \"/hbd-games/p-chat/favicon-unread.ico\";\r\n    }\r\n  }, [messages])\r\n\r\n  return (<>\r\n    <main>\r\n        <RoomSelect />\r\n        {messages && messages.map(msg => <ChatMessage key={msg.id} message={msg} />)}\r\n    </main>\r\n    <span ref={dummy}></span>\r\n\r\n    \r\n\r\n    <form onSubmit={sendMessage}>\r\n\r\n      <input value={formValue} onChange={(e) => setFormValue(e.target.value)} placeholder=\"Say something poggers\" />\r\n\r\n      <button type=\"submit\" disabled={!formValue}>📤</button>\r\n\r\n    </form>\r\n  </>)\r\n}\r\n\r\n\r\nfunction ChatMessage(props) {\r\n  const dummy = useRef();\r\n  const [formValue, setFormValue] = useState('');\r\n  const { text, uid, photoURL, createdAt, name } = props.message;\r\n\r\n  const messageClass = uid === auth.currentUser.uid ? 'sent' : 'received';\r\n\r\n  var username;\r\n\r\n  if (name !== undefined){\r\n    if (name !== auth.currentUser.displayName)\r\n    {\r\n      username = name + \" • \";\r\n    } else {\r\n      username = \"You • \"\r\n    }\r\n  } else {\r\n    username = \"Name missing • \";\r\n  }\r\n  \r\n    \r\n\r\n  var timestamp = 'Sending...';\r\n  var timestampClass = '';\r\n\r\n  if (createdAt != null) {\r\n    timestamp = new Date(createdAt.toDate());\r\n    var tsDate = timestamp.toDateString();\r\n    var tsTime = timestamp.toTimeString();\r\n\r\n    var tsTimeSplit = tsTime.split(':');\r\n\r\n    var pmAm = ' ';\r\n\r\n    if (tsTimeSplit[0] >= 13) {\r\n      var tsInt = parseInt(tsTimeSplit[0]);\r\n      tsInt = tsInt - 12;\r\n      tsTimeSplit[0] = tsInt.toString();\r\n      pmAm = 'PM';\r\n    } else {\r\n      pmAm = 'AM';\r\n    }\r\n\r\n    timestamp = `${timestamp.toDateString()}  ${tsTimeSplit[0]}:${tsTimeSplit[1]} ${pmAm}`\r\n    \r\n  }\r\n\r\n  if (messageClass === 'sent'){\r\n    timestampClass = 'tssent';\r\n  } else {\r\n    timestampClass = 'tsreceived';\r\n  }\r\n\r\n  return (<>\r\n    <div className={`message ${messageClass}`}>\r\n      <img alt=\"Profile\" src={photoURL || 'https://hideyboi.github.io/hideyboidev/p-chat/missingProfilePicture.png'} />\r\n      <div className=\"MessageContainer\"><ReactMarkdown>{text}</ReactMarkdown></div>\r\n    </div>\r\n    <div className={`timestam ${timestampClass}`} margin=\"0px\" padding=\"0px\">{username}{timestamp}</div>\r\n    <span ref={dummy}></span>\r\n  </>)\r\n}\r\n\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport firebase from 'firebase';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n","module.exports = __webpack_public_path__ + \"static/media/noti.bdc711f4.wav\";"],"sourceRoot":""}